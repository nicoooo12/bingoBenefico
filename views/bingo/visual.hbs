<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 1000001;">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-body">
          <div class="text-center mt-5">
            <p id="pnom"></p>
            <h1>
            BINGO!!!
            </h1>
          </div>
        <br>
        <br>
        <br>
        <div class="text-center mb-5">
          <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="staticBackdrop2" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 1000001;">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-body">
          <div class="text-center mt-5">
            <p id="pnom">Felisidades</p>
            <h1 id="hnom">
              Gano 
            </h1>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
          </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="staticBackdrop3" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 1000001;">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-body">
          <div class="text-center mt-5">
            <p id="pnom"></p>
            <h1>
              upps! parece que no ü§∑‚Äç‚ôÇÔ∏è 
            </h1>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
          </div>
      </div>
    </div>
  </div>
</div>

<div class="container" id="cp" >
  <div class="item-center align-middle" style="position: relative;height: 350px;width: 100%; margin-top: 25px">
    <table  class="table tb-border table-bordered align-middle" style="height: 100%; font-size:24px; border:#6f42c1 !important;">
      <tbody style="text-align: center;">
        <tr>
          <td scope="col" class="color" style="background-color: #6f42c1; color:white; font-weight: bold;">B</td>
          <td scope="col" class="num">1</td>
          <td scope="col" class="num">2</td>
          <td scope="col" class="num">3</td>
          <td scope="col" class="num">4</td>
          <td scope="col" class="num">5</td>
          <td scope="col" class="num">6</td>
          <td scope="col" class="num">7</td>
          <td scope="col" class="num">8</td>
          <td scope="col" class="num">9</td>
          <td scope="col" class="num">10</td>
          <td scope="col" class="num">11</td>
          <td scope="col" class="num">12</td>
          <td scope="col" class="num">13</td>
          <td scope="col" class="num">14</td>
          <td scope="col" class="num">15</td>
        </tr>
        <tr>
          <td scope="col" class="color" style="background-color: #6f42c1; color:white; font-weight: bold;">I</td>
          <td scope="col" class="num">16</td>
          <td scope="col" class="num">17</td>
          <td scope="col" class="num">18</td>
          <td scope="col" class="num">19</td>
          <td scope="col" class="num">20</td>
          <td scope="col" class="num">21</td>
          <td scope="col" class="num">22</td>
          <td scope="col" class="num">23</td>
          <td scope="col" class="num">24</td>
          <td scope="col" class="num">25</td>
          <td scope="col" class="num">26</td>
          <td scope="col" class="num">27</td>
          <td scope="col" class="num">28</td>
          <td scope="col" class="num">29</td>
          <td scope="col" class="num">30</td>
        </tr>
        <tr>
          <td scope="col" class="color" style="background-color: #6f42c1; color:white; font-weight: bold;">N</td>
          <td scope="col" class="num">31</td>
          <td scope="col" class="num">32</td>
          <td scope="col" class="num">33</td>
          <td scope="col" class="num">34</td>
          <td scope="col" class="num">35</td>
          <td scope="col" class="num">36</td>
          <td scope="col" class="num">37</td>
          <td scope="col" class="num">38</td>
          <td scope="col" class="num">39</td>
          <td scope="col" class="num">40</td>
          <td scope="col" class="num">41</td>
          <td scope="col" class="num">42</td>
          <td scope="col" class="num">43</td>
          <td scope="col" class="num">44</td>
          <td scope="col" class="num">45</td>
        </tr>
        <tr>
          <td scope="col" class="color" style="background-color: #6f42c1; color:white; font-weight: bold;">G</td>
          <td scope="col" class="num">46</td>
          <td scope="col" class="num">47</td>
          <td scope="col" class="num">48</td>
          <td scope="col" class="num">49</td>
          <td scope="col" class="num">50</td>
          <td scope="col" class="num">51</td>
          <td scope="col" class="num">52</td>
          <td scope="col" class="num">53</td>
          <td scope="col" class="num">54</td>
          <td scope="col" class="num">55</td>
          <td scope="col" class="num">56</td>
          <td scope="col" class="num">57</td>
          <td scope="col" class="num">58</td>
          <td scope="col" class="num">59</td>
          <td scope="col" class="num">60</td>
        </tr>
        <tr>
          <td scope="col" class="color" style="background-color: #6f42c1; color:white; font-weight: bold;">O</td>
          <td scope="col" class="num">61</td>
          <td scope="col" class="num">62</td>
          <td scope="col" class="num">63</td>
          <td scope="col" class="num">64</td>
          <td scope="col" class="num">65</td>
          <td scope="col" class="num">66</td>
          <td scope="col" class="num">67</td>
          <td scope="col" class="num">68</td>
          <td scope="col" class="num">69</td>
          <td scope="col" class="num">70</td>
          <td scope="col" class="num">71</td>
          <td scope="col" class="num">72</td>
          <td scope="col" class="num">73</td>
          <td scope="col" class="num">74</td>
          <td scope="col" class="num">75</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="item-center align-middle" style="position: relative;height: 100px;width: 100px; margin-top: 25px">
    <table class="table tb-border table-bordered" style="border:#6f42c1 !important; height: 100%; width:100%; font-size:20px ">
      <tbody>
        <tr class="color" style="background-color: #6f42c1; color:white; font-weight: bold">
          <td>
            Total
          </td>
        </tr>
        <tr>
          <td class="numTotal">
            -
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="item-center align-middle" style="position: relative;height: 100px;width: 100px; margin-top: 25px">
    <table class="table tb-border table-bordered" style="border:#6f42c1 !important; height: 100%; width:100%; font-size:20px ">
      <tbody>
        <tr class="color" style="background-color: #6f42c1; color:white; font-weight: bold">
          <td>
            numero
          </td>
        </tr>
        <tr>
          <td class="numTotal">
            <span id="numeroLanzar2"></span>
            <span id="numeroLanzar">-</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="item-center align-middle" style="position: relative;height: 100px;width: 100px; margin-top: 25px">
    <table class="table tb-border table-bordered" style="border:#6f42c1 !important; height: 100%; width:100%; font-size:20px ">
      <tbody>
        <tr class="color" style="background-color: #6f42c1; color:white; font-weight: bold">
          <td>
            Premio
          </td>
        </tr>
        <tr>
          <td id="pre">
            -
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="item-center align-middle" style="position: absolute;height: 350px;width: 100px; margin-top: 25px; top: 38%; left:14%;">
    <table class="align-middle text-center table tb-border table-bordered" style="border:#6f42c1 !important; height: 100%; width:100%; font-size:20px ">
      <tbody>
        <tr class="color" style="background-color: #6f42c1; color:white; font-weight: bold">
          {{!-- <td></td> --}}
          <td style="height: 16%;">
            Ultimas
          </td>
        </tr>
        <tr>
          {{!-- <td id="numLan"></td> --}}
          <td>
            <span id="numeroLanzadoA"></span>
            <span id="numeroLanzadoB"></span>
          </td>
        </tr>
        <tr>
          {{!-- <td id="numLan"></td> --}}
          <td >
                        <span id="numeroLanzado2A"></span>
            <span id="numeroLanzado2B"></span>
          </td>
        </tr>
        <tr>
          {{!-- <td id="numLan"></td> --}}
          <td >
                        <span id="numeroLanzado3A"></span>
            <span id="numeroLanzado3B"></span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

</div>

<script src="/socket.io/socket.io.js"></script>

<script>//document.getElementById('numeroLanzar').innerText = 0
  //window.open(document.location.origin, 'Bingo', { }, false)
  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
  let numerosAzar = [] 
  function hacerArray(){
    numerosAzar = []
    for(i=0; i <= 74; i++){
      numerosAzar.push(lansar())
    }
  }

  function removeItemFromArr ( arr, item ) {
      let i = arr.indexOf( item );
      arr.splice( i, 1 );
  }

  function numero(numeroTotoal){
      let distanciaP1 = 60,
          distanciaP2 = 20,
          distanciaP3 = 10
          distanciaP4 = 5
          distanciaP5 = 5

      let pop=0
      const actualizarNumero = ()=>{
        //console.log(pop , numerosAzar.length-1, numerosAzar[pop], numerosAzar[pop-1])
        if(pop==0){
          if(!(document.querySelectorAll('.num')[74].style.background == 'rgb(13, 110, 253)')){
            document.querySelectorAll('.num')[74].style.background = ''
          }         
        }else{
          document.querySelectorAll('.num')[numerosAzar[pop-1]-1].style.background = ''
        }
        if(pop <= (numerosAzar.length - 2)){
          document.getElementById('numeroLanzar').innerText = numerosAzar[pop]
          $('#numeroLanzar2')[0].innerText = numerosAzar[pop] <= 15 ? 'B' : numerosAzar[pop] <= 30 ? 'I' : numerosAzar[pop] <= 45 ? 'N' : numerosAzar[pop] <= 60 ? 'G' : numerosAzar[pop] <= 75 ? 'O' : ''
          document.querySelectorAll('.num')[numerosAzar[pop]-1].style.background = 'red'
          pop++
        }else{
          pop = 0
          document.getElementById('numeroLanzar').innerText = numerosAzar[pop]
          $('#numeroLanzar2')[0].innerText = numerosAzar[pop] <= 15 ? 'B' : numerosAzar[pop] <= 30 ? 'I' : numerosAzar[pop] <= 45 ? 'N' : numerosAzar[pop] <= 60 ? 'G' : numerosAzar[pop] <= 75 ? 'O' : ''
          document.querySelectorAll('.num')[numerosAzar[pop]-1].style.background = 'red'
        }
      } 
      console.log(distanciaP1+distanciaP2 +distanciaP3)
      const lanzar = async ()=>{
        if((noww ) <= distanciaP1){
          actualizarNumero()
          await sleep(5);
          noww +=1
          lanzar()
        }else if((noww ) <= (distanciaP1 + distanciaP2)){
          actualizarNumero()
          await sleep(15)
          noww += 1
          lanzar()
        }else if((noww) <= distanciaP1+distanciaP2 +distanciaP3){
          actualizarNumero()
          await sleep(30)
          noww += 1
          lanzar()
        }else if((noww) <= distanciaP1+distanciaP2 +distanciaP3+distanciaP4){
          actualizarNumero()
          await sleep(90)
          noww += 1
          lanzar()
        }else if((noww) <= distanciaP1+distanciaP2 +distanciaP3+distanciaP4+distanciaP5){
          actualizarNumero()
          await sleep(150)
          noww += 1
          lanzar()
        }else if((noww) <= distanciaP1+distanciaP2 +distanciaP3+distanciaP4+distanciaP5 +5){
          actualizarNumero()
          await sleep(250)
          noww += 1
          lanzar()
        }else{
          await sleep(1000)
          colorear(document.getElementById('numeroLanzar').innerText)
          socket.emit('lanzado', +document.getElementById('numeroLanzar').innerText)
          removeItemFromArr(numerosAzar, +document.getElementById('numeroLanzar').innerText)
          $('#numeroLanzado3A')[0].innerText = $('#numeroLanzado2A')[0].innerText
          $('#numeroLanzado3B')[0].innerText = $('#numeroLanzado2B')[0].innerText
          $('#numeroLanzado2A')[0].innerText = $('#numeroLanzadoA')[0].innerText
          $('#numeroLanzado2B')[0].innerText = $('#numeroLanzadoB')[0].innerText
          $('#numeroLanzadoA')[0].innerText = document.getElementById('numeroLanzar').innerText <= 15 ? 'B' : document.getElementById('numeroLanzar').innerText <= 30 ? 'I' : document.getElementById('numeroLanzar').innerText <= 45 ? 'N' : document.getElementById('numeroLanzar').innerText <= 60 ? 'G' : document.getElementById('numeroLanzar').innerText <= 75 ? 'O' : ''
          $('#numeroLanzadoB')[0].innerText =  document.getElementById('numeroLanzar').innerText
        }
      }
      let noww = 0
      lanzar()
  }
</script>

<script>
  var numeres = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
  var numeresAA = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
  var numeroAlazar = 0
  function lansar(){
    let tu = true
    let numeroNuevo
    while(tu){
      if(numeres.filter(e=>{return e === 1}).length == 75){
        tu = false
      }
      let v = Math.round((Math.random()*75)/1)
      //console.log(v, numeres[v], numeres[v] === 0)
      if(numeres[v-1] === 0){
        numeroNuevo = v
        tu = false
      }
    }
    numeres[numeroNuevo-1] = 1
    return numeroNuevo
    //colorear(numeroNuevo)
  }

  function colorear(num){
    numeresAA[num-1] = 1
    document.querySelector('.numTotal').innerText = numeresAA.filter(e=>{return e === 1}).length
    document.querySelectorAll('.num')[num-1].style.background = '#0d6efd'
    document.querySelectorAll('.num')[num-1].style.color = 'white'
  }



  hacerArray()
</script>

<script>
var myModal = new bootstrap.Modal(document.getElementById('staticBackdrop'), {
  keyboard: false,
  backdrop: false
})
var myModal2 = new bootstrap.Modal(document.getElementById('staticBackdrop2'), {
  keyboard: false,
  backdrop: false
})
var myModal3 = new bootstrap.Modal(document.getElementById('staticBackdrop3'), {
  keyboard: false,
  backdrop: false
})
  let socket = io()
  socket.emit('soyBingo')
  socket.on('init', (serial, premio,color)=>{
    if(serial, premio,color){
      $('#pre')[0].innerText = premio
      $('#numeroLanzar')[0].innerText = 0
      $('#numeroLanzar2')[0].innerText = ''
      $('.numTotal')[0].innerText = 0
      $('.color').css('background', color ? color : 'rgb(111, 66, 193)')
      $('.tb-border').css('border-color', color ? color : 'rgb(111, 66, 193)')
    }
  })
  socket.on('fine', (serial, premio)=>{
    document.location.href = document.location.href
  })
  socket.on('lan', ()=>{
    if($('#pre')[0].innerText !== '-'){
      numero()
    }
  })
  socket.on('gan',(data, id, user)=>{
    $('#pnom')[0].innerText = user + ' dice : '
    console.log(user)
    myModal.toggle()
    socket.emit('gann', data, numeresAA, id, user)
  })
  socket.on('genne',async (user)=>{
    $('#hnom')[0].innerText = user + ' es el GANADOR!!! üéâüéâ‚ú®'
    myModal.toggle()
    myModal2.toggle()
    await sleep(10000)
    myModal2.toggle()
  })
  socket.on('nogenne',async(user)=>{
    myModal.toggle()
    myModal3.toggle()
    await sleep(3000)
    myModal3.toggle()
  })
</script>